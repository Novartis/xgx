## Overview {data-progressive=TRUE}

![](images/xgx_splash.png){ width=100% }

<p style="font-weight:600; font-size:32px">
xGx/xGxr: Tools for the exploration of PKPD datasets.</p>

Exploratory graphics provide a quick visual solution to check your data for any 
anomalies and give the user a simple overview of the data structure.
This is particularly helpful in PKPD analysis as a step 
prior to making more complex models.

The open source packages `xgx` and `xgxr` are targeted specifically towards
exploratory graphics of PKPD analyses, with a focus to improve 
efficiency, code readability, exploratory graphic consistency, 
and act as an educational resource for PKPD analyses.



<p style="font-weight:600; font-size:16px">What types of questions can we 
answer with exploratory graphics for PKPD?</p>

### Pharmokinetic Relevant Questions
#### Longitudinal trends
  - How many compartments are observed within the data?
  - Is the clearance nonlinear?
    - (e.g. Is there a discontinuity / drop in elimination phase in log space?)

These question may be addressed in PK data by plotting the mean and confidence intervals over time,
grouped by does or assigned treatment.

 - Logarithmic scaling helps identify the number of compartments,
     linearity of elimination, and better general plot visualizations.
 - Linear scaling allows better attention towards the $C_{max}$, 
     which can be important if there is a narrow therapeutic window 
     and if $C_{max}$ is important in determining safety.

An example of a PK plot used to answer these question is given in our 
[PK - Multiple Ascending Dose template](https://opensource.nibr.com/xgx/Multiple_Ascending_Dose_PK.html#concentration_over_time,_colored_by_dose,_mean_+-_95%_ci):

```{r PK_plot1, exercise=TRUE, exercise.lines = 6, exercise.eval=TRUE, fig.height=3, fig.width=8, warning=FALSE}
gg <- ggplot(data = pk_data, 
             aes(x = NOMTIME,
                 y = LIDV, 
                 group = interaction(TRTACT_high2low, PROFDAY),
                 color = TRTACT_high2low)) 
gg <- gg + xgx_theme()
gg <- gg + xgx_geom_ci(conf_level = 0.95,
                       alpha = 0.5)
gg <- gg + xgx_scale_y_log10()
gg <- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg <- gg + labs(y = conc_label, color = trtact_label) 
gg <- gg + xgx_annotate_status(status)
print(gg)
```

<!-- ![](https://opensource.nibr.com/xgx/Multiple_Ascending_Dose_PK_files/figure-html/unnamed-chunk-3-1.png){ width=100% } -->


#### Dosage trends
  - PK linearity - Is dose-normalized AUC or $C_{max}$ consistent across dosages? 
    (This provides information regarding how dosage adjustments affect response)

If the normalized concentration across doses is observed to increase with 
increasing dosages, this may indicate a nonlinear clearance.  
Conversely, if the lowest dosage is associated with a larger and more 
variable normalized concentration, this may be an indication that the 
signal to noise ratio is low 
- i.e. the data is close to the lower limit of detection.

An example of the type of plot which is helpful to answer these questions is 
given in our [PK - Single Ascending Dose template](https://opensource.nibr.com/xgx/Single_Ascending_Dose_PK.html#nca_of_dose_normalized_auc_and_cmax_vs_dose):

```{r PK_plot1, exercise=TRUE, exercise.lines = 5, exercise.eval=TRUE, fig.height=3, fig.width=8, warning=FALSE}
gg <- ggplot(data = NCA, aes(x = DOSE, y = VALUE_NORM))
gg <- gg + geom_boxplot(aes(group = DOSE)) 
gg <- gg + geom_smooth(method = "lm", color = "black")
gg <- gg + facet_wrap(~PARAM, scales = "free_y", ncol = 4)
gg <- gg + labs(x = dose_label, y = concnorm_label)
gg <- gg + xgx_annotate_status(status)
print(gg)
```
<!-- ![](https://opensource.nibr.com/xgx/Single_Ascending_Dose_PK_files/figure-html/unnamed-chunk-6-1.png){ width=100% } -->


### Pharmacodynamic Relevant Questions

Questions relevant to the pharmacodynamics of a study are dependent 
upon the PD data type (e.g. continuous, binary, or ordinal)

#### Longitudinal trends
  - How quickly is a steady state reached?

#### Dosage trends
  - Is the PD response, efficacy, or safety a function of dose?
  - Is the dosage large enough to reach an asymptote?
  - What is the $E_{max}$ or $ED_{50}$?


An example of the type of plot which is helpful to answer these questions is 
given in our [PD, Dose-Response - Binary Response template](https://opensource.nibr.com/xgx/Multiple_Ascending_Dose_PD_binary.html#responder-rate-95-ci-by-dose-for-endpoint-of-interest"):

```{r PK_plot1, exercise=TRUE, exercise.lines = 5, exercise.eval=TRUE, fig.height=3, fig.width=8, warning=FALSE}
pd_data_to_plot <- binary_data %>% subset(PROFDAY == SS_PROFDAY)

gg <- ggplot(data = pd_data_to_plot, aes(x = DOSE,y = LIDV))
gg <- gg + xgx_stat_ci(conf_level = .95,distribution = "binomial", geom = list("point","errorbar"))
gg <- gg + geom_smooth(method = "glm", method.args = list(family = binomial(link = logit)), color = "black")
gg <- gg + scale_y_continuous(breaks = seq(0, 1, 0.25), labels = scales::percent)
gg <- gg + coord_cartesian(ylim = c(0, 1))
gg <- gg + labs(x = dose_label, y = binary_label)
gg <- gg + xgx_annotate_status(status)

pp1 <- gg + ggtitle("Dose on Linear Scale")
#print(pp1)

## Same plot but on a log scale
pp2 <- gg + scale_x_log10(breaks = unique(pd_data_to_plot$DOSE))+ ggtitle("Dose on Log Scale")
#print(pp2)
grid.arrange(pp1,pp2,nrow = 1)
```

<!-- ![](https://opensource.nibr.com/xgx/Multiple_Ascending_Dose_PD_binary_files/figure-html/unnamed-chunk-7-1.png){ width=100% } -->

### Questions about Sources of Variablility

#### Inter-subject variability
Between-subject variability can be easily visualized as a spaghetti plot, 
as we have shown in our [Single Ascending Dose PK template](https://opensource.nibr.com/xgx/Single_Ascending_Dose_PK.html#explore_covariate_effects_on_pk)

```{r PK_plot1, exercise=TRUE, exercise.lines = 5, exercise.eval=TRUE, fig.height=3, fig.width=8, warning=FALSE}
gg <- ggplot(data = pk_data, aes(x = NOMTIME, y = LIDV, color = SEX)) 
gg <- gg + xgx_stat_ci(conf_level = 0.95)

gg <- gg + xgx_scale_y_log10()
gg <- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg <- gg + labs(y = conc_label)

gg <- gg + facet_grid(.~TRTACT_low2high) 
gg <- gg + xgx_annotate_status(status)
print(gg)
```
<!-- ![](https://opensource.nibr.com/xgx/Single_Ascending_Dose_PK_files/figure-html/unnamed-chunk-10-1.png){ width=100% } -->

#### Intra-subject variability

Within-subject variability is most simply viewed as a spaghetti plot, that 
has been faceted by the individual, such as the one shown below:

```{r PK_plot1, exercise=TRUE, exercise.lines = 5, exercise.eval=TRUE, fig.height=7, fig.width=8, warning=FALSE}
# In order to plot grayed out spaghetti plots by dose with individuals highlighted, 
# a new dataset needs to be defined that groups the individuals by dose
pk_data_rep_by_trt <- list()
for(id in unique(pk_data$ID)){
  indiv_data <- pk_data %>% subset(ID == id)
  itrtact = unique(indiv_data$TRTACT_low2high)
  
  pk_data_rep_by_trt[[as.character(id)]] <- pk_data %>% 
        subset(TRTACT_low2high == itrtact) %>% 
        mutate(ID_rep_by_trt = ID, ID = id)
}
pk_data_rep_by_trt <- bind_rows(pk_data_rep_by_trt)

gg <- ggplot(mapping = aes(x = TIME, y = LIDV)) 
# Plot gray underlaid spaghettis
gg <- gg + geom_line(data = pk_data_rep_by_trt, 
                     aes(group = interaction(ID_rep_by_trt, PROFDAY)), 
                     size = 1, color = rgb(0.5, 0.5, 0.5), alpha = 0.3)
gg <- gg + geom_point(data = pk_data_rep_by_trt, 
                     size = 1, color = rgb(0.5, 0.5, 0.5), alpha = 0.3)
# plot overlaid individuals
gg <- gg + geom_line(data = pk_data, 
                     aes(group = interaction(ID, PROFDAY)), size = 1)
gg <- gg + geom_point(data = pk_data %>% filter(CENS == 0), size = 1)
gg <- gg + geom_point(data = pk_data %>% filter(CENS == 1), 
                      color = "red",  shape = 8, size = 2)
gg <- gg + xgx_scale_y_log10()
gg <- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg <- gg + labs(y = conc_label)
gg <- gg + theme(legend.position = "none")
gg <- gg + facet_wrap(~ID + TRTACT_low2high, 
                ncol = 10 )
gg <- gg + xgx_annotate_status(status, fontsize = 4, color = rgb(0.5, 0.5, 1))
gg <- gg + theme(panel.grid.minor.x = ggplot2::element_line(color = rgb(0.9,0.9,0.9)),
      panel.grid.minor.y = ggplot2::element_line(color = rgb(0.9,0.9,0.9)))
print(gg)
```

<!-- ![](https://opensource.nibr.com/xgx/Multiple_Ascending_Dose_PK_files/figure-html/unnamed-chunk-15-1.png){ width=100% } -->

#### Explained vs Unexplained Variability
  * Explained variability
    - Between-subject:
      - Traditional covariates
    - Within-subject:
      - Circadian rhythms, seasonal effects, food effects, disease progression
  * Explained variability
    - Between-subject:
      - Unaccounted for covariates
    - Within-subject:
      - Residual error, poor absorption, other unaccounted for effects
