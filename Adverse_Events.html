<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Fariba Khanshan" />


<title>Safety Plots</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  
</style>


<span class=visible-sm-block> </span>
<span class=visible-md-block> </span>
<span class=visible-lg-block> </span>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">xGx</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="glyphicon glyphicon-home"></span>
     
  </a>
</li>
<li>
  <a href="GuidingPrinciples.html">Guiding Principles</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Datasets.html">Dataset Specifications</a>
    </li>
    <li>
      <a href="PKPD_Datasets.html">Master PK/PD Datasets used in creating example plots</a>
    </li>
    <li>
      <a href="Data_Checking.html">Data Checking</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dose-PK/Exposure
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Single_Ascending_Dose_PK.html">Single Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK.html">Multiple Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK_KeyPlots.html">Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dose-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Oncology_Efficacy_Plots.html">Oncology Efficacy Endpoints (RECIST)</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_real_example.html">PD/Efficacy Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    PK-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Adverse_Events.html">Adverse Events</a>
    </li>
  </ul>
</li>
<li>
  <a href="Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  .navbar-image {width: 150px;}
  .warning { 
      font-size: 200% ; 
      color: red; 
      padding-top: 200px;
    }
    }
  
  @media (min-width: 992px) and (max-width: 1200px){
    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 110px;
  margin-top: -110px;
  }

  .section h2 {
  padding-top: 110px;
  margin-top: -110px;
  }
  
    .section h3 {
  padding-top: 110px;
  margin-top: -110px;
  }
  }
  
  
  @media (min-width: 768px) and (max-width: 991px){

    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 160px;
  margin-top: -160px;
  }

  .section h2 {
  padding-top: 160px;
  margin-top: -160px;
  }
  
    .section h3 {
  padding-top: 160px;
  margin-top: -160px;
  }
  }
  
@media (max-width: 768px){
  .navbar-image {width: 19%;}

}
  

</style>


<!--[if IE]>
<p/>
<p/>
<p class="warning"> Dear Internet Explorer user: Please ensure compatibility view settings are turned OFF in order to view this website propertly. For best results, use Chrome. <br/>
<p/>
 <![endif]--> 


<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Safety Plots</h1>
<h4 class="author">Fariba Khanshan</h4>

</div>


<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This document contains plots for safety data as well as the R code
that generates these graphs. These plots are not strictly exploratory
plots as data from a PopPK model are used to generate some of the
plots.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<pre class="r"><code>library(ggplot2)
library(dplyr)
library(tidyr)
library(gridExtra)
library(zoo)
library(xgxr)

#flag for labeling figures as draft
status = &quot;DRAFT&quot;

## ggplot settings
xgx_theme_set()</code></pre>
</div>
<div id="load-dataset" class="section level2">
<h2>Load Dataset</h2>
<p>The plots presented here are based on merged safety data with a popPK
model generated parameters data (<a href="Data/AE_xgx.csv">download
dataset</a>), as well as a dataset containing model-generated AUCs (<a
href="Data/AUC_Safety.csv">download dataset</a>). Data specifications
can be accessed on <a href="Datasets.html">Datasets</a> and Rmarkdown
template to generate this page can be found on <a
href="Rmarkdown/Adverse_Events.Rmd">Rmarkdown-Template</a>.</p>
<pre class="r"><code>auc &lt;- read.csv(&quot;../Data/AUC_Safety.csv&quot;)
ae.data &lt;- read.csv(&quot;../Data/AE_xgx.csv&quot;)
ae.data$DOSE_label &lt;- paste(ae.data$Dose,&quot;mg&quot;)
ae.data = ae.data %&gt;%
  arrange(DOSE_label) %&gt;%
  mutate(DOSE_label_low2high      = factor(DOSE_label, levels = unique(DOSE_label)),
         DOSE_label_high2low      = factor(DOSE_label, levels = rev(unique(DOSE_label))))

#ensure dataset has all the necessary columns
ae.data = ae.data %&gt;%
  mutate(SUBJID      = SUBJID,           # ID   column
         DAY         = DAY,              # Day of the AE
         time        = time,             # time of the AE in (h)
         Dose        = Dose,             # DOSE column here (numeric value)
         AUC         = AUC,              # Cumulative AUC at AE day
         Cmax        = Cmax,             # Cmax at AE day
         Cmin        = Cmin,             # Cmin at AE day\
         AUCDAY1     = AUCDAY1,          # AUC at day 1
         AUCAVE      = AUCAVE,           #  Average AUC up to the AE day
         AETOXGRS    = AETOXGRS,         #  AE grades (Character)
         AETOXGRDN   = AETOXGRDN,        #  AE grades (numenric)
         AE          = AE,               #  Binary YES/NO AE
         )

auc = auc %&gt;%
  mutate(SUBJID       = SUBJID,           # Subject ID
         time_hr      =time_hr,         #   Simulation time in (h)
         AUC_popPK    = AUC_popPK,      # Cumulative AUC from popPK model
         Cmax_popPK   = Cmax_popPK,     #   Cmax from popPK
         Cmin_popPK   = Cmin_popPK      #   Cmin from popPK
         )

# add binary 0 and 1 colun to the dataset
ae.data$AE_binary &lt;- as.numeric(as.character( plyr::mapvalues(ae.data$AE,
                                                               c(&#39;Yes&#39;,&#39;No&#39;), 
                                                               c(1, 0)) ))

# AUC dataset for additional plots
ae.data = ae.data %&gt;%
  mutate(AUC_bins = cut(AUCAVE, quantile(AUCAVE, na.rm=TRUE), na.rm=TRUE, include.lowest = TRUE)) %&gt;%
  group_by(AUC_bins) %&gt;%
  mutate(AUC_midpoints = median(AUCAVE))

# Function to add number of subjects in each group
n_fun &lt;- function(x){
  return(data.frame(y = median(x)*0.01, label = paste0(&quot;n = &quot;,length(x))))
}

#units and labels
time_units_dataset = &quot;hours&quot;
time_units_plot    = &quot;days&quot;
trtact_label       = &quot;Dose&quot;
dose_label         = &quot;Dose (mg)&quot;
time_label         = &quot;Time(Days)&quot;
timemonth_label    = &quot;Time (months)&quot;
conc_label         = &quot;Concentration (ng/ml)&quot;
trough_label       = &quot;Trough Concentration (ng/mL)&quot;
conc_units         = &quot;ng/ml&quot;
auctau_label       = &quot;AUCtau (ng.h/ml)&quot;
ae_label           = &quot;AE&quot;
aeprob_label       = &quot;Probability of AE (%)&quot;
sld_label          = &quot;Percent Change in\nSum of Longest Diameters&quot;

#directories for saving individual graphs
dirs = list(
parent_dir= tempdir(),
rscript_dir  = &quot;./&quot;,
rscript_name = &quot;Example.R&quot;,
results_dir  = &quot;./&quot;,
filename_prefix   = &quot;&quot;,
filename     = &quot;Example.png&quot;)</code></pre>
</div>
<div id="exposure-safety-plots" class="section level2">
<h2>Exposure-safety plots</h2>
<p>These plots are looking at the AUC (or Cmax and Ctrough) for patients
with the AE and for those who don’t have the AE at each dose group. The
number of the patients at each dose level is also included in the plots.
With these type of plots we are looking to see if there is a correlation
(or absence a correlation) between exposure and AE.</p>
<div id="auc-vs-dose-group-by-ae" class="section level3">
<h3>AUC vs Dose group by AE</h3>
<pre class="r"><code>gg &lt;- ggplot(data= ae.data,aes(x=factor(Dose), y=AUCAVE, fill=factor(AE))) 
gg &lt;- gg + geom_boxplot(data=ae.data,aes(x=factor(Dose),y=AUCAVE, fill=factor(AE)),outlier.shape = NA)
gg &lt;- gg + geom_point(color=&quot;black&quot;,binaxis=&#39;y&#39;, stackdir=&#39;center&#39;,dotsize=0.5,
                   position=position_jitterdodge(0.27))
gg &lt;- gg + guides(color=guide_legend(&quot;&quot;))
gg &lt;- gg + stat_summary(data=ae.data, fun.data = n_fun, geom = &quot;text&quot;,
                     fun.y=mean, position = position_dodge(width = 0.75)) 
gg &lt;- gg + scale_fill_discrete(name=&quot;AE occurrence:&quot;)
gg &lt;- gg + ylab(&quot;&quot;)
gg &lt;- gg + labs(y=auctau_label,x=dose_label)
gg &lt;- gg + xgx_annotate_status(status)
gg</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
</div>
<div id="explore-ae-vs-auc" class="section level3">
<h3>Explore AE vs AUC</h3>
<p>Plot binary AE occurrence against AUC or Cmax.</p>
<pre class="r"><code>gg &lt;- ggplot(data = ae.data, aes(y=AUCAVE,x=AE))
gg &lt;- gg + geom_jitter(data = ae.data, 
                       aes(color = DOSE_label_high2low), shape=19,  width = 0.1, height = 0, alpha = 0.5)
gg &lt;- gg + geom_boxplot(width = 0.5, fill = NA, outlier.shape=NA) 
gg &lt;- gg + guides(color=guide_legend(&quot;&quot;),fill=guide_legend(&quot;&quot;))
gg &lt;- gg + coord_flip() 
gg &lt;- gg + labs(y=auctau_label,x=ae_label)
gg &lt;- gg + xgx_annotate_status(status)
gg</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-4-1.png" width="768" /></p>
</div>
</div>
<div id="probability-of-ae-for-each-dose-group" class="section level2">
<h2>Probability of AE for each dose group</h2>
<p>Plot binary AE occurrence against dose. Using summary statistics can
be helpful, e.g. Mean +/- SE, or median, 5th &amp; 95th percentiles. For
binary response data, plot the percent responders along with binomial
confidence intervals.</p>
<p>Here are some questions to ask yourself when looking at Dose-safety
plots: Do you see any relationship? Does AE increase (decrease) with
increasing dose?</p>
<pre class="r"><code>gg1 &lt;- ggplot(data = ae.data, aes(x=Dose,y=AE_binary))
gg1 &lt;- gg1 + geom_smooth( method = &quot;glm&quot;,method.args=list(family=binomial(link = logit)), color = &quot;black&quot;)
gg1 &lt;- gg1 + xgx_stat_ci(conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;point&quot;), shape = 0, size = 4)
gg1 &lt;- gg1 + xgx_stat_ci(conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;errorbar&quot;), size = 0.5)
gg1 &lt;- gg1 + guides(color=guide_legend(&quot;&quot;),fill=guide_legend(&quot;&quot;))
gg1 &lt;- gg1 + scale_y_continuous(labels=scales::percent) 
gg1 &lt;- gg1 + labs(y=aeprob_label,x=dose_label)
gg1 &lt;- gg1 + xgx_annotate_status(status)

## Same plot but on a log scale
gg2 &lt;- gg1 + xgx_scale_x_log10(breaks=unique(ae.data$Dose)) 

#put linear and log scale plots side-by-side:
grid.arrange(gg1, gg2, ncol=2)</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<div id="probability-of-ae-by-auc" class="section level3">
<h3>Probability of AE by AUC</h3>
<p>Plot AE against exposure. Include a logistic regression for binary
data to help determine the shape of the exposuresafety relationship.
Summary information such as mean and 95% confidence intervals by
quartiles of exposure can also be plotted. Exposure and Cmax metric that
you use in these pltots could be either be raw concentrations, or NCA or
model-derived exposure metrics (e.g. Cmin, Cmax, AUC), and may depend on
the level of data that you have available.</p>
<pre class="r"><code>gg &lt;- ggplot(data = ae.data, aes(x=AUCAVE,y=AE_binary))
gg &lt;- gg + geom_jitter(aes( color = DOSE_label_high2low), width = 0, height = 0.05, alpha = 0.5) 
gg &lt;- gg + geom_smooth( method = &quot;glm&quot;,method.args=list(family=binomial(link = logit)), color = &quot;black&quot;)
gg &lt;- gg + xgx_stat_ci(mapping = aes(x = AUC_midpoints, y = AE_binary), 
                       conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;point&quot;), shape = 0, size = 4)
gg &lt;- gg + xgx_stat_ci(mapping = aes(x = AUC_midpoints, y = AE_binary), 
                       conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;errorbar&quot;), size = 0.5)
gg &lt;- gg + guides(color=guide_legend(&quot;&quot;),fill=guide_legend(&quot;&quot;))
gg &lt;- gg + scale_y_continuous(breaks=c(0,1)) + coord_cartesian(ylim=c(-0.2,1.2))
gg &lt;- gg + labs(x=auctau_label,y=ae_label)
gg &lt;- gg + xgx_annotate_status(status)
gg</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
</div>
</div>
<div id="boxplots-of-exposure-over-time-with-ae-highlighted"
class="section level2">
<h2>Boxplots of Exposure over time, with AE highlighted</h2>
<p>The plot below shows time vs AUC from a pop PK model at each day. The
colored dots corresponding to adverse events. It is not strictly an
exploratory plot. But once you have a PopPK model, it is simple to
generate this plot. Just plot the time vs the predicted AUC and color
the time points red on days that an adverse event occurred.</p>
<pre class="r"><code>data_to_plot &lt;- ae.data %&gt;% subset(!is.na(AETOXGRDN),)
gg &lt;- ggplot()
gg &lt;- gg + geom_jitter(data=auc %&gt;% subset(AUC_day&lt;30,), 
                       aes(x=AUC_day, y=AUC_popPK/AUC_day, group=AUC_day),
                       color=&quot;grey&quot;, alpha = 0.5, 
                       position=position_jitter(width=.1, height=0))
gg &lt;- gg + geom_boxplot(data=auc %&gt;% subset(AUC_day&lt;30,), 
                        aes(x=AUC_day, y=AUC_popPK/AUC_day, group=AUC_day),
                        outlier.shape = NA, fill = NA)
gg &lt;- gg + geom_point(data=data_to_plot %&gt;% subset(DAY&lt;30,), 
                      aes(x=DAY, y=AUC/DAY, color=factor(AETOXGRS)),size=2)
gg &lt;- gg + scale_color_manual(breaks = c(&quot;GR1&quot;, &quot;GR2&quot;, &quot;GR3&quot;),
                        values=c(rgb(1,0.5,0.5), rgb(0.75,0.25,0.25), rgb(0.5,0,0)))
gg &lt;- gg + guides(color=guide_legend(&quot;&quot;),fill=guide_legend(&quot;&quot;))
gg &lt;- gg + scale_x_continuous(breaks = seq(0, 30, by = 3))
gg &lt;- gg + xgx_annotate_status(status)
gg &lt;- gg + labs(x=time_label,y=auctau_label)
gg</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
<div
id="oncology-individual-plots-of-percent-change-from-baseline-including-dosing-history-labeled-by-overall-response-and-ae-grade"
class="section level2">
<h2>Oncology individual plots of percent change from baseline, including
dosing history, labeled by “Overall Response” and AE grade</h2>
<p>These plots allow one to look for subtle trends in the individual
trajectories with respect to the dosing history, safety events and
efficacy as percent change of tunor size from baseline. The plots below
make use of the following oncology datasets: RECIST and nmpk dataset <a
href="Oncology_Efficacy_Data.csv">(download here)</a> and dose record
dataset <a href="Oncology_Efficacy_Dose.csv">(download here)</a></p>
<pre class="r"><code># Read oncology efficacy data from the oncology efficacy 
# page and combine them with safety data in this page

safety_data &lt;- read.csv(&quot;../Data/AE_xgx.csv&quot;)
efficacy_data &lt;- read.csv(&quot;../Data/Oncology_Efficacy_Data.csv&quot;)
dose_record &lt;- read.csv(&quot;../Data/Oncology_Efficacy_Dose.csv&quot;)

efficacy_data$DOSE_label &lt;- paste(efficacy_data$DOSE_ABC,&quot;mg&quot;)
efficacy_data$DOSE_label &lt;- factor(efficacy_data$DOSE_label,levels = c(paste(unique(efficacy_data$DOSE_ABC),&quot;mg&quot;)))

efficacy_data.monotherapy = efficacy_data %&gt;% filter(COMB==&quot;Single&quot;)
efficacy_data.combo = efficacy_data %&gt;% filter(COMB==&quot;Combo&quot;)


# Dose record data preparation for making step function plot
# in order to show any dose reduction during the study
# the idea is that at each time point, you have both the current dose and the previous dose
# the dplyr::lag command implements this
data_areaStep &lt;- bind_rows(old = dose_record,
                           new = dose_record %&gt;% 
                 group_by(IDSHORT) %&gt;% 
                 mutate(DOSE = lag(DOSE)),
                        .id  = &quot;source&quot;) %&gt;%
                 arrange(IDSHORT, TIME, source) %&gt;%
  ungroup() %&gt;%
  mutate(DOSE = ifelse(lag(IDSHORT)!=IDSHORT, NA, DOSE), 
          TIME = TIME/24) #convert to days

data_areaStep.monotherapy = filter(data_areaStep,COMB==&quot;Single&quot;)

# calculate average dose intensity up to the first assessment:
# &quot;TIME==57&quot;&quot; is the first assessment time in this dataset
first.assess.time = 57
dose_record &lt;- dose_record %&gt;%
  group_by(IDSHORT) %&gt;%
  mutate(ave_dose_intensity = mean(DOSE[TIME/24 &lt; first.assess.time]))

dose_intensity &lt;- dose_record[c(&quot;IDSHORT&quot;,&quot;COMB&quot;,&quot;ave_dose_intensity&quot;)]
dose_intensity &lt;- subset(dose_intensity, !duplicated(IDSHORT))


# This part is optional to label &quot;OR&quot; in the plot
# &quot;OR&quot; can be substituted with other information, such as non-target, new target lesions
#  make the OR label for the plot


safety_label &lt;- safety_data %&gt;%
  select(SUBJID, DAY, AETOXGRS, Dose)

colnames(safety_label)[2] &lt;- &quot;TIME&quot;
colnames(safety_label)[4] &lt;- &quot;DOSE_ABC&quot;
safety_label$AETOXGRS &lt;- as.character(safety_label$AETOXGRS)
safety_label &lt;- safety_label[!safety_label$AETOXGRS ==&quot;&quot;,]

efficacy_AE_label &lt;- efficacy_data %&gt;%
  select(SUBJID, TIME, psld, DOSE_ABC)
efficacy_AE_label &lt;- merge(safety_label,efficacy_AE_label, by = c(&quot;SUBJID&quot;, &quot;TIME&quot;,&quot;DOSE_ABC&quot;),
                            all.x=T, all.y=T)

subj &lt;- efficacy_AE_label  %&gt;% 
  subset(!is.na(psld)) %&gt;%
  group_by(SUBJID) %&gt;%
  mutate(CountNonNa = length(psld))

subj &lt;- c(unique(subset(subj, CountNonNa&gt;1, &quot;SUBJID&quot;)))

efficacy_AE_label &lt;- efficacy_AE_label  %&gt;% 
  subset(SUBJID%in%subj$SUBJID)%&gt;%
  group_by(SUBJID) %&gt;%
  mutate(ValueInterp = na.approx(psld,TIME, na.rm=FALSE))

efficacy_AE_label &lt;- efficacy_AE_label[!is.na(efficacy_AE_label$AETOXGRS),]
efficacy_AE_label &lt;- efficacy_AE_label[!is.na(efficacy_AE_label$ValueInterp),]
efficacy_AE_label &lt;- subset( efficacy_AE_label, select = -psld )
colnames(efficacy_AE_label)[5] &lt;- &quot;psld&quot;
colnames(efficacy_AE_label)[1] &lt;- &quot;IDSHORT&quot;



efficacy_data.label &lt;- efficacy_data %&gt;%
  group_by(SUBJID) %&gt;%
  mutate(label_psld = as.numeric(ifelse(TIME==TIME_OR , psld,&quot;&quot;))) %&gt;%
  filter(!(is.na(label_psld) | label_psld==&quot;&quot;))

dose.shift = 50
dose.scale = 1.2
data_areaStep.monotherapy = data_areaStep.monotherapy %&gt;%
  mutate(DOSE.shift = DOSE/dose.scale+dose.shift)

dose.unique = c(0,unique(efficacy_data.monotherapy$DOSE_ABC))


gg &lt;- ggplot(data = efficacy_data.monotherapy)
gg &lt;- gg + geom_point(mapping = aes(y= psld, x= TIME))
gg &lt;- gg + geom_text(data= efficacy_data.label,aes(y= label_psld, x= TIME_OR, label=OR), vjust=-.5)
gg &lt;- gg + geom_hline(aes(yintercept = 0),size=0.1, colour=&quot;black&quot;)
gg &lt;- gg + geom_line(mapping = aes(y= psld, x= TIME))
gg &lt;- gg + geom_ribbon(data= data_areaStep.monotherapy,
                       aes( ymin = 50, ymax = DOSE.shift , x= TIME),
                       fill=&quot;palegreen2&quot;, color = &quot;black&quot;, alpha=0.5 )
gg &lt;- gg + geom_text(data= efficacy_AE_label,
                     aes(y= psld, x= TIME, label=AETOXGRS), colour=&quot;red&quot;,fontface=2,
                     size=5, show.legend = F, hjust=-0.05, vjust=2)
gg &lt;- gg + geom_vline(data= efficacy_AE_label,
                      aes(xintercept= TIME), 
                      size=1, linetype=&quot;dashed&quot;, colour=&quot;red&quot;)
gg &lt;- gg + facet_wrap(~IDSHORT, ncol=6)
gg &lt;- gg + scale_y_continuous(
  sec.axis = sec_axis(~(.-dose.shift)*dose.scale, name = &quot;Dose(mg)&quot;, breaks = dose.unique))
gg &lt;- gg + labs(y = sld_label, x= timemonth_label)
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = &quot;day&quot;, units_plot =&quot;month&quot;)
gg &lt;- gg + theme(text = element_text(size=15))
gg &lt;- gg + xgx_annotate_status(status)
gg</code></pre>
<p><img src="Adverse_Events_files/figure-html/unnamed-chunk-8-1.png" width="960" /></p>
</div>
<div id="r-session-info" class="section level2">
<h2>R Session Info</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Red Hat Enterprise Linux Server 7.9 (Maipo)
## 
## Matrix products: default
## BLAS/LAPACK: /CHBS/apps/EB/software/imkl/2019.1.144-gompi-2019a/compilers_and_libraries_2019.1.144/linux/mkl/lib/intel64_lin/libmkl_gf_lp64.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8   
##  [6] LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] xgxr_1.1.1    zoo_1.8-11    gridExtra_2.3 tidyr_1.2.1   dplyr_1.0.10  ggplot2_3.3.6
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-160        bitops_1.0-7        RColorBrewer_1.1-3  Deriv_4.1.3         tools_4.1.0         backports_1.4.1     bslib_0.4.0        
##  [8] utf8_1.2.2          R6_2.5.1            rpart_4.1.16        mgcv_1.8-41         Hmisc_4.7-0         DBI_1.1.3           colorspace_2.0-3   
## [15] nnet_7.3-17         withr_2.5.0         tidyselect_1.2.0    Exact_2.1           compiler_4.1.0      cli_3.4.1           htmlTable_2.2.1    
## [22] binom_1.1-1         expm_0.999-6        labeling_0.4.2      sass_0.4.2          scales_1.2.1        checkmate_2.1.0     mvtnorm_1.1-3      
## [29] readr_2.1.3         proxy_0.4-26        stringr_1.4.1       digest_0.6.30       foreign_0.8-82      rmarkdown_2.17      base64enc_0.1-3    
## [36] jpeg_0.1-9          pkgconfig_2.0.3     htmltools_0.5.3     fastmap_1.1.0       highr_0.9           htmlwidgets_1.5.4   rlang_1.0.6        
## [43] rstudioapi_0.14     jquerylib_0.1.4     generics_0.1.3      farver_2.1.1        jsonlite_1.8.3      RCurl_1.98-1.4      magrittr_2.0.3     
## [50] Formula_1.2-4       interp_1.1-2        Matrix_1.5-1        Rcpp_1.0.9          DescTools_0.99.42   munsell_0.5.0       fansi_1.0.3        
## [57] lifecycle_1.0.3     stringi_1.7.8       yaml_2.3.6          MASS_7.3-58.1       rootSolve_1.8.2.2   plyr_1.8.7          grid_4.1.0         
## [64] lmom_2.8            deldir_1.0-6        lattice_0.20-45     splines_4.1.0       pander_0.6.4        hms_1.1.2           knitr_1.40         
## [71] pillar_1.8.1        boot_1.3-28         gld_2.6.2           codetools_0.2-18    glue_1.6.2          evaluate_0.17       latticeExtra_0.6-30
## [78] data.table_1.14.2   png_0.1-7           vctrs_0.5.0         tzdb_0.3.0          gtable_0.3.1        purrr_0.3.5         assertthat_0.2.1   
## [85] cachem_1.0.6        xfun_0.34           e1071_1.7-8         class_7.3-19        survival_3.4-0      minpack.lm_1.2-1    tibble_3.1.8       
## [92] cluster_2.1.3       ellipsis_0.3.2</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
