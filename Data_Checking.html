<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Andy Stein, Siyan Xu" />


<title>Data Checking</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.26/datatables.js"></script>
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  
</style>


<span class=visible-sm-block> </span>
<span class=visible-md-block> </span>
<span class=visible-lg-block> </span>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">xGx</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="glyphicon glyphicon-home"></span>
     
  </a>
</li>
<li>
  <a href="GuidingPrinciples.html">Guiding Principles</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Datasets.html">Dataset Specifications</a>
    </li>
    <li>
      <a href="PKPD_Datasets.html">Master PK/PD Datasets used in creating example plots</a>
    </li>
    <li>
      <a href="Data_Checking.html">Data Checking</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dose-PK/Exposure
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Single_Ascending_Dose_PK.html">Single Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK.html">Multiple Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK_KeyPlots.html">Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dose-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Oncology_Efficacy_Plots.html">Oncology Efficacy Endpoints (RECIST)</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_real_example.html">PD/Efficacy Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    PK-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Adverse_Events.html">Adverse Events</a>
    </li>
  </ul>
</li>
<li>
  <a href="Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  .navbar-image {width: 150px;}
  .warning { 
      font-size: 200% ; 
      color: red; 
      padding-top: 200px;
    }
    }
  
  @media (min-width: 992px) and (max-width: 1200px){
    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 110px;
  margin-top: -110px;
  }

  .section h2 {
  padding-top: 110px;
  margin-top: -110px;
  }
  
    .section h3 {
  padding-top: 110px;
  margin-top: -110px;
  }
  }
  
  
  @media (min-width: 768px) and (max-width: 991px){

    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 160px;
  margin-top: -160px;
  }

  .section h2 {
  padding-top: 160px;
  margin-top: -160px;
  }
  
    .section h3 {
  padding-top: 160px;
  margin-top: -160px;
  }
  }
  
@media (max-width: 768px){
  .navbar-image {width: 19%;}

}
  

</style>


<!--[if IE]>
<p/>
<p/>
<p class="warning"> Dear Internet Explorer user: Please ensure compatibility view settings are turned OFF in order to view this website propertly. For best results, use Chrome. <br/>
<p/>
 <![endif]--> 


<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data Checking</h1>
<h4 class="author">Andy Stein, Siyan Xu</h4>
<h4 class="date">17 April, 2023</h4>

</div>


<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Example of plots and tables to create for data checking.</p>
<p>For a dataset that is much larger that the example one used here, the
default figure size may be too small for all plots to be readable. In
that case, add or edit the <code>fig.height</code> and
<code>fig.width</code> in the top of each chunk. For example:
<code>{r, fig.height = 6, fig.width = 8}</code></p>
<p>Data specifications can be accessed on <a
href="Datasets.html">Datasets</a> and Rmarkdown template to generate
this page can be found on <a
href="Rmarkdown/Data_Checking.Rmd">Rmarkdown-Template</a>. You may also
download the Multiple Ascending Dose PK/PD dataset for your reference
(<a href="Data/Data_Checking.csv">download dataset</a>).</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<pre class="r"><code>library(tidyverse)
library(DT)
library(xgxr)

#set chunk default options
xgx_theme_set()
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.height = 4, fig.width = 4)
options(DT.options = list(pageLength = 20)) #pageLength = number of entries per page

#specify the time units and your covariates 
covariates = c(&quot;WEIGHT0&quot;,&quot;AGE0&quot;,&quot;SEX&quot;,&quot;WEIGHT0_CAT&quot;)
time_units_dataset = &quot;days&quot;</code></pre>
</div>
<div id="load-data" class="section level2">
<h2>Load Data</h2>
<pre class="r"><code>filename = &quot;../Data/Data_Checking.csv&quot;
data_in = read.csv(filename, stringsAsFactors = FALSE)

data = data_in %&gt;%
  # in this mutate command are all columns that are required for this check
  # if your dataset has different naming convention, 
  # then rename the right hand side of the equality
  mutate(USUBJID = USUBJID, # Unique subject identifier
         TIME    = TIME,    # Actual Time
         NOMTIME = NOMTIME, # Nominal Time
         AMT     = AMT,     # Dose Amount
         LIDV    = LIDV,    # Dependent variable
         YTYPE   = YTYPE,   # Number for type of dependent variable
         NAME    = NAME,    # Name for the type of dependent variable (e.g. PK)
         MDV     = MDV,     # Missing Dependent Varibale (0 = no, 1 = yes)
         CENS    = CENS,    # Censored Data (0 = no, 1 = yes)
         EVID    = EVID,    # Event ID.  0 = Dependent Variabale, 1 = dose
         TRT     = TRT,     # Treatment Arm character description
         TRTN    = TRTN) %&gt;%# Treatment Arm numeric description (used for sorting)
  arrange(TRTN) %&gt;%
  mutate(TRT_low2high = factor(TRT, levels = unique(TRT)),
         TRT_high2low = factor(TRT, levels = rev(unique(TRT))))
                                 
data1 = data %&gt;%
  filter(!duplicated(USUBJID))</code></pre>
<div
id="data-manipulation-to-simulate-a-patient-with-no-doses-and-introduce-new-variables"
class="section level3">
<h3>Data Manipulation to simulate a patient with no doses and introduce
new variables</h3>
<pre class="r"><code>data = data %&gt;%
  mutate(USUBJID = paste0(&quot;PAT&quot;,USUBJID),
         WEIGHT0_CAT = case_when(WEIGHT0 &lt; 60 ~ &quot;WT&lt;60&quot;, #creating 2nd categorical var
                                 WEIGHT0 &gt; 80 ~ &quot;WT&gt;80&quot;,
                                 TRUE         ~ &quot;WT:60-80&quot;))

# a patient with no PK or PD data is added to the dataset to illustrate how the 
# data checking will report when such data is present.  This code block should be
# removed if you&#39;ll be using it with your dataset.
empty_row = data[1,] %&gt;%
  mutate(ID = 23,
         USUBJID = paste0(&quot;PAT&quot;,ID),
         LIDV = 0,
         YTYPE = 0,
         ADM = 1,
         CMT = 0,
         NAME = &quot;Dose&quot;, 
         EVENTU = &quot;mg&quot;,
         UNIT = &quot;mg&quot;,
         MDV = 1,
         CENS = 0,
         EVID = 1)

data  = bind_rows(data, empty_row)
data1 = data %&gt;%
  filter(!duplicated(USUBJID))</code></pre>
</div>
</div>
<div id="number-of-patients-per-treatment-arm" class="section level2">
<h2>Number of Patients per Treatment Arm</h2>
<p>Check to see the number of patients in the dataset is what you
expect.</p>
<pre class="r"><code>total_patients = data %&gt;%
  filter(!duplicated(USUBJID)) %&gt;%
  tally() %&gt;%
  rename(n_patients = n) %&gt;%
  mutate(TRT_low2high = &quot;TOTAL NUMBER&quot;)

summary_by_trt = data %&gt;% 
  filter(!duplicated(USUBJID)) %&gt;%
  group_by(TRT_low2high) %&gt;%
  tally() %&gt;%
  rename(n_patients = n) %&gt;% 
  bind_rows(total_patients)
datatable(summary_by_trt)</code></pre>
<div id="htmlwidget-7e29e295d2c8bba7fe46" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7e29e295d2c8bba7fe46">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["3 mg","6 mg","12 mg","24 mg","48 mg","TOTAL NUMBER"],[2,2,3,2,5,14]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>TRT_low2high<\/th>\n      <th>n_patients<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="number-of-data-points-per-treatment-arm-and-ytype"
class="section level2">
<h2>Number of Data Points per Treatment Arm and YTYPE</h2>
<p>This is another quick way to see if there is way more or way less
data than you expected.</p>
<pre class="r"><code>summary_by_trt_ytype = data %&gt;% 
  group_by(YTYPE, NAME, TRT_low2high) %&gt;%
  tally() %&gt;%
  rename(n_data_points = n) %&gt;%
  mutate(YTYPE_NAME = paste0(YTYPE, &quot;:&quot;, NAME)) %&gt;%
  ungroup() %&gt;%
  select(-YTYPE, -NAME) %&gt;%
  spread(YTYPE_NAME, n_data_points)

datatable(summary_by_trt_ytype)</code></pre>
<div id="htmlwidget-7980d019f209f6f839bc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7980d019f209f6f839bc">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],["3 mg","6 mg","12 mg","24 mg","48 mg"],[8,8,7,12,95],[18,24,20,32,86],[17,24,20,28,55]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>TRT_low2high<\/th>\n      <th>0:Dose<\/th>\n      <th>1:PK<\/th>\n      <th>2:PD<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="dosing-summary" class="section level2">
<h2>Dosing Summary</h2>
<p>Summary of the dosing information. It can be useful to know if there
are patients in the database that never received a dose of the drug.
Also, usually AMT usually should not equal 0, and so</p>
<pre class="r"><code>dose = data %&gt;%
  filter(EVID == 1)

dose_summ = data %&gt;%
  group_by(USUBJID) %&gt;%
  summarize(total_dose = sum(AMT))

dose_summary = data.frame(
  patients_that_never_received_drug = sum(dose_summ$total_dose == 0),
  entries_where_AMT_equals_0        = sum(dose$AMT == 0),
  entries_where_AMT_greater_than_0  = sum(dose$AMT &gt; 0)) %&gt;%
  t() %&gt;%
  as.data.frame() %&gt;%
  rename(N = V1)

datatable(dose_summary)</code></pre>
<div id="htmlwidget-288878c1fc5c1e195e59" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-288878c1fc5c1e195e59">{"x":{"filter":"none","vertical":false,"data":[["patients_that_never_received_drug","entries_where_AMT_equals_0","entries_where_AMT_greater_than_0"],[1,1,129]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>N<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="dependent-variable-dv-summary" class="section level2">
<h2>Dependent Variable (DV) Summary</h2>
<pre class="r"><code># compute number of DV by YTYPE and by patient
# with this method, NAs also mean 0
# here we do not remove EVID == 0 records, 
# so that patients with a dose but no DV values will be included in the count
dv_number_by_patient = data %&gt;%
  group_by(YTYPE, USUBJID) %&gt;%
  summarize(n_obs = sum(MDV == 0 &amp; !is.na(LIDV))) %&gt;%
  ungroup() %&gt;%
  spread(YTYPE, n_obs)
  
# count total number of patients missing any DV of each type
dv_number_summary = dv_number_by_patient %&gt;%  
  select(-USUBJID) %&gt;%
  summarize_all(c(Nnone   = function(x) sum(x == 0 | is.na(x)), 
                  Nmin    = function(x) min(x, na.rm = TRUE),
                  Nmedian = function(x) round(median(x, na.rm = TRUE)),
                  Nmax    = function(x) max(x, na.rm = TRUE))) %&gt;%
  t() %&gt;%
  as.data.frame() %&gt;%
  rename(N = V1)
dv_number_summary$YTYPE_SUMM = row.names(dv_number_summary)
dv_number_summary = dv_number_summary %&gt;%
  mutate(YTYPE = as.numeric(str_extract(YTYPE_SUMM, &quot;^\\d+&quot;)),
         SUMM  = str_extract(YTYPE_SUMM, &quot;[A-Za-z]+$&quot;)) %&gt;%
  select(-YTYPE_SUMM) %&gt;%
  spread(SUMM, N)

# create an overall summary table
dv_summary_overall = data %&gt;%
  filter(EVID == 0) %&gt;%
  group_by(YTYPE, NAME) %&gt;%
  summarize(n_total           = n(),
            n_missing_or_NA   = sum(is.na(LIDV) | MDV == 1),
            n_zeroes          = sum(LIDV == 0),
            n_censored        = sum(CENS == 1),
            n_negative        = sum(LIDV &lt; 0),
            n_duplicate_times = sum(duplicated(paste(USUBJID,TIME))),
            min               = min     (LIDV,       na.rm = TRUE),
            Q1                = quantile(LIDV, 0.25, na.rm = TRUE),
            median            = median  (LIDV,       na.rm = TRUE),
            Q3                = quantile(LIDV, 0.75, na.rm = TRUE),
            max               = max     (LIDV,       na.rm = TRUE)) %&gt;%
  left_join(dv_number_summary, by = &quot;YTYPE&quot;) %&gt;%
  mutate(YTYPE_NAME = paste0(YTYPE,&quot;:&quot;,NAME)) %&gt;%
  ungroup() %&gt;%
  select(-YTYPE, -NAME) %&gt;%
  t() %&gt;%
  as.data.frame()
names(dv_summary_overall) = as.matrix(dv_summary_overall[&quot;YTYPE_NAME&quot;,])
dv_summary_overall$Value = row.names(dv_summary_overall)
row.names(dv_summary_overall) = c()

dv_summary_overall = dv_summary_overall %&gt;%
  filter(Value != &quot;YTYPE_NAME&quot;) %&gt;%
  mutate(Type = case_when(str_detect(Value, &quot;^n_&quot;) ~ &quot;Number of data points&quot;,
                          str_detect(Value, &quot;^N&quot;)  ~ &quot;Number of data points per patient&quot;,
                          TRUE                     ~ &quot;Value of data points&quot;)) %&gt;%
  mutate(Value = str_replace(Value, &quot;^n_&quot;, &quot;&quot;), 
         Value = str_replace(Value, &quot;^N&quot;, &quot;&quot;)) %&gt;%
  select(Type, Value, everything()) %&gt;%
  arrange(Type)

datatable(dv_summary_overall)</code></pre>
<div id="htmlwidget-2271b7ce2a9d04503f0a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2271b7ce2a9d04503f0a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Number of data points","Number of data points","Number of data points","Number of data points","Number of data points","Number of data points","Number of data points per patient","Number of data points per patient","Number of data points per patient","Number of data points per patient","Value of data points","Value of data points","Value of data points","Value of data points","Value of data points"],["total","missing_or_NA","zeroes","censored","negative","duplicate_times","max","median","min","none","min","Q1","median","Q3","max"],["180","0","0","11","0","2","24","15","1","2","6.966","89.39825","503.052","1442.6782","18325.380"],["144","0","0"," 1","0","1","21","14","7","4","2.015","23.52375"," 69.880"," 143.2493"," 1023.214"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Type<\/th>\n      <th>Value<\/th>\n      <th>1:PK<\/th>\n      <th>2:PD<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="covariate-summary" class="section level2">
<h2>Covariate Summary</h2>
<p>Provide overview of the covariates. Check to see in particular that
the distributions (along the diagonals) make sense.</p>
<pre class="r"><code>num_unique_vals = data1[,covariates] %&gt;%
  summarise_all(function(x){length(unique(x))}) %&gt;%
  as.numeric()

cts_cov = data1[,covariates[num_unique_vals &gt;= 8]]
cat_cov = data1[,covariates[num_unique_vals &lt;  8]]

cts_cov_summary = cts_cov %&gt;%
  gather() %&gt;%
  group_by(key) %&gt;%
  summarise(n_missing_or_NA   = sum(is.na(value)),
            min               = min     (value,       na.rm = TRUE),
            Q1                = quantile(value, 0.25, na.rm = TRUE),
            median            = median  (value,       na.rm = TRUE),
            Q3                = quantile(value, 0.75, na.rm = TRUE),
            max               = max     (value,       na.rm = TRUE))
datatable(cts_cov_summary)</code></pre>
<div id="htmlwidget-6f49419ebf95d1385452" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6f49419ebf95d1385452">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["AGE0","WEIGHT0"],[0,0],[54,47.1],[61.5,55.6],[65.5,70.15],[67,88.3],[75,112.1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>key<\/th>\n      <th>n_missing_or_NA<\/th>\n      <th>min<\/th>\n      <th>Q1<\/th>\n      <th>median<\/th>\n      <th>Q3<\/th>\n      <th>max<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>cat_summary = function(x) {
  unique_x = sort(unique(x))
  str = 1:length(unique_x)
  for(i in 1:length(unique_x))
  {
    str[i] = paste0(unique_x[i], &quot;=&quot;, sum(x == unique_x[i], na.rm = TRUE))
  }
  output = paste(str, collapse = &quot;, &quot;)
}

cat_cov_summary = cat_cov %&gt;%
  gather() %&gt;%
  group_by(key) %&gt;%
  summarise(n_missing_or_NA   = sum(is.na(value)),
            n_distinct        = n_distinct(value),
            count_summary     = cat_summary(value))
datatable(cat_cov_summary)</code></pre>
<div id="htmlwidget-11dba10a5a7b7c9c58b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-11dba10a5a7b7c9c58b4">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["SEX","WEIGHT0_CAT"],[0,0],[2,3],["Female=7, Male=7","WT:60-80=4, WT&lt;60=5, WT&gt;80=5"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>key<\/th>\n      <th>n_missing_or_NA<\/th>\n      <th>n_distinct<\/th>\n      <th>count_summary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>GGally::ggpairs(data1, 
                columns = covariates,
                diag = list(continuous = &quot;barDiag&quot;))</code></pre>
<p><img src="Data_Checking_files/figure-html/unnamed-chunk-8-3.png" width="768" /></p>
</div>
<div id="columns-that-contains-nas-and-the-number-they-contain"
class="section level2">
<h2>Columns that contains NAs (and the number they contain)</h2>
<p>Often, a dataset is not supposed to contain any NAs. This section
highlights where the NAs occur. If the table below is empty, then there
are no NAs in the dataset.</p>
<pre class="r"><code>na_summary = data %&gt;%
  dplyr::summarise_all(function(x) {sum(is.na(x))}) %&gt;%
  t() %&gt;%
  as.data.frame() %&gt;%
  rename(N_NA = V1) 
na_summary$Column = names(data)
na_summary = na_summary %&gt;%
  select(Column, N_NA) %&gt;%
  filter(N_NA &gt; 0)

datatable(na_summary)</code></pre>
<div id="htmlwidget-29b1f9dbbb0ce0f2b97a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-29b1f9dbbb0ce0f2b97a">{"x":{"filter":"none","vertical":false,"data":[["NOMTIME","LIDV","PROFDAY","CYCLE","LLOQ"],["NOMTIME","LIDV","PROFDAY","CYCLE","LLOQ"],[111,129,115,7,129]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Column<\/th>\n      <th>N_NA<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="dose-and-pkpd-data-collection-times" class="section level2">
<h2>Dose and PK/PD Data Collection Times</h2>
<p>Get an overview of the timing of the dose, PK, and PD data collection
for all patients and make sure it’s in line with expectations. Each “x”
denotes a record, i.e. a dose time or a PK or PD assessment time. Each
red circle denotes what may be a dose interruption, when the time
between doses is greater than <code>DT_flag</code> and
<code>NAME == "Dose"</code></p>
<p>You might need to adjust the figure height and width in the line
below, depending on how many different YTYPEs and how many patients your
dataset has.</p>
<pre class="r"><code>DT_flag = 10   # &gt;10 days between doses is flagged
NAME_DOSE = &quot;Dose&quot; # NAME == NAME_DOSE is flagged

data_dose_interruption = data %&gt;%
  group_by(USUBJID, NAME) %&gt;%
  mutate(DT   = lead(TIME, default = max(TIME)) - TIME,
         TMID = TIME + DT/2) %&gt;%
  ungroup() %&gt;%
  filter(DT &gt; DT_flag, NAME == NAME_DOSE)

g = ggplot(data, aes(x = TIME, y = USUBJID)) 
g = g + geom_point(shape = 4)
g = g + geom_point(data = data_dose_interruption,
                   aes(x = TMID, y = USUBJID),
                   color = &quot;red&quot;, alpha = 0.2, size = 5)
g = g + xgx_scale_x_time_units(units_dataset = time_units_dataset)
g = g + facet_wrap(~YTYPE+NAME, labeller = label_both)
print(g)</code></pre>
<p><img src="Data_Checking_files/figure-html/unnamed-chunk-10-1.png" width="768" /></p>
</div>
<div id="nominal-vs-actual-time-discrepancies-nominal-time-summary"
class="section level2">
<h2>Nominal vs Actual Time Discrepancies + Nominal Time Summary</h2>
<p>A common error is that either the nominal or actual time were derived
incorrectly. Thus a quick sanity check is to plot nominal vs actual
time. Any points that don’t lie near the identity line require further
investigation.</p>
<pre class="r"><code>xymin = min(c(data$NOMTIME, data$TIME), na.rm = TRUE)
xymax = max(c(data$NOMTIME, data$TIME), na.rm = TRUE)

g = ggplot(data = data, aes(x = TIME, y = NOMTIME))
g = g + geom_point()
g = g + annotate(&quot;segment&quot;, x = xymin, xend = xymax, y = xymin, yend = xymax, color = &quot;blue&quot;)
g = g + xlim(c(xymin, xymax))
g = g + ylim(c(xymin, xymax))
print(g)</code></pre>
<p><img src="Data_Checking_files/figure-html/unnamed-chunk-11-1.png" width="384" /></p>
<pre class="r"><code>difftime = data %&gt;%
  mutate(DIFF_TIME = abs(NOMTIME - TIME)) %&gt;%
  arrange(-DIFF_TIME) %&gt;%
  slice(1:10)

difftime %&gt;%
  select(USUBJID, TRT, DIFF_TIME, TIME, NOMTIME, YTYPE, NAME, LIDV) %&gt;%
  DT::datatable(difftime)</code></pre>
<div id="htmlwidget-068f16737f970c9977fb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-068f16737f970c9977fb">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["PAT15","PAT15","PAT16","PAT16","PAT21","PAT5","PAT5","PAT5","PAT5","PAT4"],["12 mg","12 mg","12 mg","12 mg","48 mg","48 mg","48 mg","48 mg","48 mg","48 mg"],[545.95,545.95,540.09,540.09,526.92,3.08,3.06,3.05,2.88,2.2],[22.05,22.05,27.91,27.91,41.08,67.92,46.94,53.95,89.12,82.8],[568,568,568,568,568,71,50,57,92,85],[1,2,1,2,1,0,0,0,0,1],["PK","PD","PK","PD","PK","Dose","Dose","Dose","Dose","PK"],[79.579,102.632,22.206,184.424,1558.455,null,null,null,null,3567.963]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>USUBJID<\/th>\n      <th>TRT<\/th>\n      <th>DIFF_TIME<\/th>\n      <th>TIME<\/th>\n      <th>NOMTIME<\/th>\n      <th>YTYPE<\/th>\n      <th>NAME<\/th>\n      <th>LIDV<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"ID":[15,15,16,16,21,5,5,5,5,4],"USUBJID":["PAT15","PAT15","PAT16","PAT16","PAT21","PAT5","PAT5","PAT5","PAT5","PAT4"],"TIME":[22.05,22.05,27.91,27.91,41.08,67.92,46.94,53.95,89.12,82.8],"NOMTIME":[568,568,568,568,568,71,50,57,92,85],"TIMEUNIT":["Days","Days","Days","Days","Days","Days","Days","Days","Days","Days"],"AMT":[0,0,0,0,0,48,48,48,48,0],"LIDV":[79.579,102.632,22.206,184.424,1558.455,null,null,null,null,3567.963],"YTYPE":[1,2,1,2,1,0,0,0,0,1],"ADM":[0,0,0,0,0,1,1,1,1,0],"CMT":[1,2,1,2,1,0,0,0,0,1],"NAME":["PK","PD","PK","PD","PK","Dose","Dose","Dose","Dose","PK"],"EVENTU":["ng/mL","ng/mL","ng/mL","ng/mL","ng/mL","mg","mg","mg","mg","ng/mL"],"UNIT":["ng/mL","ng/mL","ng/mL","ng/mL","ng/mL","mg","mg","mg","mg","ng/mL"],"MDV":[0,0,0,0,0,1,1,1,1,0],"CENS":[0,0,0,0,0,0,0,0,0,0],"EVID":[0,0,0,0,0,1,1,1,1,0],"AGEB":[64,64,68,67,60,62,61,65,65,55],"AGE0":[64,64,68,67,60,62,61,65,65,55],"WEIGHTB":[85.7,85.5,93.6,92.5,70.1,75,75.7,83.2,82.7,54.3],"WEIGHT0":[85.7,85.5,93.6,92.5,70.1,75,75.7,83.2,82.7,54.3],"SEXN":[1,1,1,1,1,2,2,2,2,1],"SEX":["Male","Male","Male","Male","Male","Female","Female","Female","Female","Male"],"TRTN":[12,12,12,12,48,48,48,48,48,48],"TRT":["12 mg","12 mg","12 mg","12 mg","48 mg","48 mg","48 mg","48 mg","48 mg","48 mg"],"PROFDAY":[null,null,null,null,null,null,null,56,84,84],"VISNAME":["EOT","EOT","EOT","EOT","EOT","CYCLE 3 DAY 15","CYCLE 2 DAY 22","CYCLE 3 DAY 1","CYCLE 4 DAY 8","CYCLE 4 DAY 1"],"CYCLE":[null,null,null,null,null,3,2,3,4,4],"LLOQ":[10,10,10,10,10,null,null,null,null,10],"TRT_low2high":["12 mg","12 mg","12 mg","12 mg","48 mg","48 mg","48 mg","48 mg","48 mg","48 mg"],"TRT_high2low":["12 mg","12 mg","12 mg","12 mg","48 mg","48 mg","48 mg","48 mg","48 mg","48 mg"],"WEIGHT0_CAT":["WT>80","WT>80","WT>80","WT>80","WT:60-80","WT:60-80","WT:60-80","WT>80","WT>80","WT<60"],"DIFF_TIME":[545.95,545.95,540.09,540.09,526.92,3.08,3.06,3.05,2.88,2.2],"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div id="unique-nominal-time-values" class="section level3">
<h3>Unique Nominal Time values</h3>
<p>Look at the nominal times in the dataset, just to make sure they’re
correct. In this case, there is a mistake because nominal time has units
of days and the 5m, 1h, 2h, 4h, and 8h nominal time values were all set
to “1” rather than having unique values (i.e. 1 hour should be 1/24 =
0.041 rather than 1).</p>
<pre class="r"><code>cat(sort(unique(data$NOMTIME)))</code></pre>
<pre><code>## 1 2 4 8 15 22 29 30 32 36 43 50 57 64 71 78 85 92 99 106 113 120 127 134 141 148 155 162 169 176 183 190 197 204 568</code></pre>
</div>
</div>
<div id="r-session-info" class="section level2">
<h2>R session info</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Red Hat Enterprise Linux Server 7.9 (Maipo)
## 
## Matrix products: default
## BLAS/LAPACK: /CHBS/apps/EB/software/imkl/2019.1.144-gompi-2019a/compilers_and_libraries_2019.1.144/linux/mkl/lib/intel64_lin/libmkl_gf_lp64.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8   
##  [6] LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] DT_0.26         forcats_0.5.2   stringr_1.4.1   purrr_0.3.5     readr_2.1.3     tibble_3.1.8    tidyverse_1.3.2 xgxr_1.1.1      zoo_1.8-11     
## [10] gridExtra_2.3   tidyr_1.2.1     dplyr_1.0.10    ggplot2_3.3.6  
## 
## loaded via a namespace (and not attached):
##   [1] googledrive_2.0.0   colorspace_2.0-3    deldir_1.0-6        ellipsis_0.3.2      class_7.3-19        htmlTable_2.2.1     base64enc_0.1-3    
##   [8] fs_1.5.2            gld_2.6.2           rstudioapi_0.14     proxy_0.4-26        farver_2.1.1        Deriv_4.1.3         fansi_1.0.3        
##  [15] mvtnorm_1.1-3       lubridate_1.8.0     xml2_1.3.3          codetools_0.2-18    splines_4.1.0       cachem_1.0.6        rootSolve_1.8.2.2  
##  [22] knitr_1.40          Formula_1.2-4       jsonlite_1.8.3      broom_1.0.1         binom_1.1-1         cluster_2.1.3       dbplyr_2.2.1       
##  [29] png_0.1-7           compiler_4.1.0      httr_1.4.4          backports_1.4.1     assertthat_0.2.1    Matrix_1.5-1        fastmap_1.1.0      
##  [36] gargle_1.2.1        cli_3.4.1           prettyunits_1.1.1   htmltools_0.5.3     tools_4.1.0         gtable_0.3.1        glue_1.6.2         
##  [43] lmom_2.8            Rcpp_1.0.9          cellranger_1.1.0    jquerylib_0.1.4     vctrs_0.5.0         nlme_3.1-160        crosstalk_1.2.0    
##  [50] xfun_0.34           rvest_1.0.3         lifecycle_1.0.3     googlesheets4_1.0.1 MASS_7.3-58.1       scales_1.2.1        hms_1.1.2          
##  [57] expm_0.999-6        RColorBrewer_1.1-3  yaml_2.3.6          Exact_2.1           pander_0.6.4        sass_0.4.2          rpart_4.1.16       
##  [64] reshape_0.8.8       latticeExtra_0.6-30 stringi_1.7.8       highr_0.9           e1071_1.7-8         checkmate_2.1.0     boot_1.3-28        
##  [71] rlang_1.0.6         pkgconfig_2.0.3     bitops_1.0-7        evaluate_0.17       lattice_0.20-45     htmlwidgets_1.5.4   labeling_0.4.2     
##  [78] tidyselect_1.2.0    GGally_2.1.2        plyr_1.8.7          magrittr_2.0.3      R6_2.5.1            DescTools_0.99.42   generics_0.1.3     
##  [85] Hmisc_4.7-0         DBI_1.1.3           pillar_1.8.1        haven_2.5.1         foreign_0.8-82      withr_2.5.0         mgcv_1.8-41        
##  [92] survival_3.4-0      RCurl_1.98-1.4      nnet_7.3-17         crayon_1.5.2        modelr_0.1.9        interp_1.1-2        utf8_1.2.2         
##  [99] tzdb_0.3.0          rmarkdown_2.17      progress_1.2.2      jpeg_0.1-9          grid_4.1.0          readxl_1.4.1        minpack.lm_1.2-1   
## [106] data.table_1.14.2   reprex_2.0.2        digest_0.6.30       munsell_0.5.0       bslib_0.4.0</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
