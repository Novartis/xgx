<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Alison Margolskee, Andy Stein" />


<title>PK/PD, Exposure-Response - Binary</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  
</style>


<span class=visible-sm-block> </span>
<span class=visible-md-block> </span>
<span class=visible-lg-block> </span>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">xGx</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="glyphicon glyphicon-home"></span>
     
  </a>
</li>
<li>
  <a href="GuidingPrinciples.html">Guiding Principles</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Datasets.html">Dataset Specifications</a>
    </li>
    <li>
      <a href="PKPD_Datasets.html">Master PK/PD Datasets used in creating example plots</a>
    </li>
    <li>
      <a href="Data_Checking.html">Data Checking</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dose-PK/Exposure
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Single_Ascending_Dose_PK.html">Single Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK.html">Multiple Ascending Dose - PK</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PK_KeyPlots.html">Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dose-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Oncology_Efficacy_Plots.html">Oncology Efficacy Endpoints (RECIST)</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PD_real_example.html">PD/Efficacy Example using realistic data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    PK-PD/Efficacy/Safety
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_continuous.html">Continuous</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_binary.html">Binary Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_ordinal.html">Ordinal Response</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_count.html">Count Data</a>
    </li>
    <li>
      <a href="Multiple_Ascending_Dose_PKPD_time_to_event.html">Time to Event</a>
    </li>
    <li>
      <a href="Adverse_Events.html">Adverse Events</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Resources/PKPD_Exploratory_Graphics_(xGx)_Cheat_Sheet.pdf">PKPD Cheat Sheet</a>
    </li>
    <li>
      <a href="Resources/Graphics_Principles_Cheat_Sheet_v1.1.pdf">Graphics Principles Cheat Sheet</a>
    </li>
    <li>
      <a href="Resources/FundamentalPK_AndyStein_Hackathon_2019.pptx">Fundamental PK Principles Introduction</a>
    </li>
    <li>
      <a href="Resources/FundamentalPD_AndyStein_Hackathon_2019.pptx">Fundamental PD Principles Introduction</a>
    </li>
    <li>
      <a href="Resources/Presentation_Checklist_v2.03.pdf">Presentation Checklist</a>
    </li>
    <li>
      <a href="Resources/Uncertainty_Assessment_Pedigree_Table.pdf">Uncertainty Assessment - Pedigree Table</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<style type="text/css">
  .visible-sm-block {padding-top: 120px;}
  .visible-md-block {padding-top: 60px;}
  .visible-lg-block {padding-top: 0px;}
  .navbar-image {width: 150px;}
  .warning { 
      font-size: 200% ; 
      color: red; 
      padding-top: 200px;
    }
    }
  
  @media (min-width: 992px) and (max-width: 1200px){
    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 110px;
  margin-top: -110px;
  }

  .section h2 {
  padding-top: 110px;
  margin-top: -110px;
  }
  
    .section h3 {
  padding-top: 110px;
  margin-top: -110px;
  }
  }
  
  
  @media (min-width: 768px) and (max-width: 991px){

    .navbar-image {width: 19%;}
    
    .section h1 {
  padding-top: 160px;
  margin-top: -160px;
  }

  .section h2 {
  padding-top: 160px;
  margin-top: -160px;
  }
  
    .section h3 {
  padding-top: 160px;
  margin-top: -160px;
  }
  }
  
@media (max-width: 768px){
  .navbar-image {width: 19%;}

}
  

</style>


<!--[if IE]>
<p/>
<p/>
<p class="warning"> Dear Internet Explorer user: Please ensure compatibility view settings are turned OFF in order to view this website propertly. For best results, use Chrome. <br/>
<p/>
 <![endif]--> 


<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">PK/PD, Exposure-Response - Binary</h1>
<h4 class="author">Alison Margolskee, Andy Stein</h4>

</div>


<div id="overview" class="section level2">
<h2>Overview</h2>
<!--START_EXPLANATION-->
<p>This document contains exploratory plots for binary response data as well as the R code that generates these graphs.The plots presented here are based on simulated data (<a href="PKPD_Datasets.html">see: PKPD Datasets</a>). Data specifications can be accessed on <a href="Datasets.html">Datasets</a> and Rmarkdown template to generate this page can be found on <a href="Rmarkdown/Multiple_Ascending_Dose_PKPD_binary.Rmd">Rmarkdown-Template</a>. You may also download the Multiple Ascending Dose PK/PD dataset for your reference (<a href="Data/Multiple_Ascending_Dose_Dataset2.csv">download dataset</a>). <!--END_EXPLANATION--> ## Setup</p>
<pre class="r"><code>library(ggplot2)
library(dplyr)
library(xgxr)
library(tidyr)

#set seed for random number generator (for plots with jitter)
set.seed(12345)

#flag for labeling figures as draft
status = &quot;DRAFT&quot;

# ggplot settings
xgx_theme_set()

#directories for saving individual graphs
dirs = list(
  parent_dir = &quot;Parent_Directory&quot;,
  rscript_dir  = &quot;./&quot;,
  rscript_name = &quot;Example.R&quot;,
  results_dir  = &quot;./&quot;,
  filename_prefix   = &quot;&quot;,
  filename     = &quot;Example.png&quot;)</code></pre>
</div>
<div id="load-dataset" class="section level2">
<h2>Load Dataset</h2>
<!--START_EXPLANATION-->
<p>The plots presented here are based on simulated data (<a href="PKPD_Datasets.html">see: PKPD Datasets</a>). You may also download the Multiple Ascending Dose PK/PD dataset for your reference (<a href="Data/Multiple_Ascending_Dose_Dataset2.csv">download dataset</a>). <!--END_EXPLANATION--></p>
<pre class="r"><code>#load dataset
pkpd_data &lt;- read.csv(&quot;../Data/Multiple_Ascending_Dose_Dataset2.csv&quot;)

DOSE_CMT = 1
PK_CMT = 2
PD_CMT = 6
SS_PROFDAY = 6 # steady state prof day
PD_PROFDAYS &lt;- c(0, 2, 4, 6)
TAU = 24 # time between doses, units should match units of TIME, e.g. 24 for QD, 12 for BID, 7*24 for Q1W (when units of TIME are h)

#ensure dataset has all the necessary columns
pkpd_data = pkpd_data %&gt;%
  mutate(ID      = ID,     #ID   column
         TIME    = TIME,   #TIME column name 
         NOMTIME = NOMTIME,#NOMINAL TIME column name
         PROFDAY = case_when(
           NOMTIME &lt; (SS_PROFDAY - 1)*24 ~ 1 + floor(NOMTIME / 24),
           NOMTIME &gt;= (SS_PROFDAY - 1)*24 ~ SS_PROFDAY
         ), #PROFILE DAY day associated with profile, e.g. day of dose administration
         LIDV    = LIDV,   #DEPENDENT VARIABLE column name
         CENS    = CENS,   #CENSORING column name
         CMT     = CMT,    #COMPARTMENT column
         DOSE    = DOSE,   #DOSE column here (numeric value)
         TRTACT  = TRTACT, #DOSE REGIMEN column here (character, with units),
         LIDV_NORM = LIDV/DOSE,
         LIDV_UNIT    = EVENTU,
         DAY_label = ifelse(PROFDAY &gt; 0, paste(&quot;Day&quot;, PROFDAY), &quot;Baseline&quot;),
         BINARY_LEVELS = factor(case_when(
           CMT != PD_CMT ~ as.character(NA), 
           LIDV == 0 ~ &quot;Nonresponder&quot;, 
           LIDV == 1 ~ &quot;Responder&quot;
         ), levels = c(&quot;Nonresponder&quot;, &quot;Responder&quot;))
  )

#create a factor for the treatment variable for plotting
pkpd_data = pkpd_data %&gt;%
  arrange(DOSE) %&gt;%
  mutate(TRTACT_low2high = factor(TRTACT, levels = unique(TRTACT)),
         TRTACT_high2low = factor(TRTACT, levels = rev(unique(TRTACT)))) %&gt;%
  select(-TRTACT)    

#create pk dataset
pk_data &lt;- pkpd_data %&gt;%
  filter(CMT==PK_CMT)

#create pd binary dataset
pd_data &lt;- pkpd_data %&gt;%
  filter(CMT==PD_CMT) %&gt;%
  mutate(LIDV_jitter = jitter(LIDV, amount = 0.1))

#create wide pkpd dataset for plotting PK vs PD
pkpd_data_wide = pd_data %&gt;%
  select(ID, NOMTIME, PD = LIDV, BINARY_LEVELS) %&gt;%
  right_join(pk_data %&gt;% select(-BINARY_LEVELS), by = c(&quot;ID&quot;, &quot;NOMTIME&quot;)) %&gt;%
  rename(CONC = LIDV) %&gt;%
  filter(!is.na(PD))

#perform NCA, for additional plots
NCA = pk_data %&gt;%
  group_by(ID, DOSE) %&gt;%
  filter(!is.na(LIDV)) %&gt;%
  summarize(AUC_0 = ifelse(length(LIDV[NOMTIME &gt; 0 &amp; NOMTIME &lt;= TAU]) &gt; 1,
                              caTools::trapz(TIME[NOMTIME &gt; 0 &amp; NOMTIME &lt;= TAU], 
                                      LIDV[NOMTIME &gt; 0 &amp; NOMTIME &lt;= TAU]),
                              NA), 
            Cmax_0     = ifelse(length(LIDV[NOMTIME &gt; 0 &amp; NOMTIME &lt;= TAU]) &gt; 1,
                              max(LIDV[NOMTIME &gt; 0 &amp; NOMTIME &lt;= TAU]),
                              NA), 
            AUC_tau = ifelse(length(LIDV[NOMTIME &gt; (SS_PROFDAY-1)*24 &amp; 
                                           NOMTIME &lt;= ((SS_PROFDAY-1)*24 + TAU)]) &gt; 1,
                             caTools::trapz(TIME[NOMTIME &gt; (SS_PROFDAY-1)*24 &amp; 
                                                   NOMTIME &lt;= ((SS_PROFDAY-1)*24 + TAU)],
                                     LIDV[NOMTIME &gt; (SS_PROFDAY-1)*24 &amp; 
                                            NOMTIME &lt;= ((SS_PROFDAY-1)*24 + TAU)]),
                             NA),
            Cmax_tau     = ifelse(length(LIDV[NOMTIME &gt; (SS_PROFDAY-1)*24 &amp; 
                                                NOMTIME &lt;= ((SS_PROFDAY-1)*24 + TAU)]) &gt; 1,
                             max(LIDV[NOMTIME &gt; (SS_PROFDAY-1)*24 &amp; 
                                        NOMTIME &lt;= ((SS_PROFDAY-1)*24 + TAU)]),
                             NA),
            SEX      = SEX[1], #this part just keeps the SEX and WEIGHTB covariates
            WEIGHTB  = WEIGHTB[1]) %&gt;%
  gather(PARAM, VALUE,-c(ID, DOSE, SEX, WEIGHTB)) %&gt;%
  ungroup() %&gt;%
  mutate(VALUE_NORM = VALUE/DOSE,
         PROFDAY = ifelse(PARAM %in% c(&quot;AUC_0&quot;, &quot;Cmax_0&quot;), 1, SS_PROFDAY))

#add response data at day 1 and at steady state to NCA for additional plots
NCA &lt;- pd_data %&gt;% subset(PROFDAY %in% c(1, SS_PROFDAY),) %&gt;%
                       select(ID, PROFDAY, DAY_label, PD = LIDV, TRTACT_low2high, TRTACT_high2low) %&gt;%
                       merge(NCA, by = c(&quot;ID&quot;, &quot;PROFDAY&quot;))

#units and labels
  time_units_dataset = &quot;hours&quot;
  time_units_plot    = &quot;days&quot;
  trtact_label       = &quot;Dose&quot;
  dose_units         = unique((pkpd_data %&gt;% filter(CMT == DOSE_CMT))$LIDV_UNIT) %&gt;% as.character()
  dose_label         = paste0(&quot;Dose (&quot;, dose_units, &quot;)&quot;)
  conc_units         = unique(pk_data$LIDV_UNIT) %&gt;% as.character()
  conc_label         = paste0(&quot;Concentration (&quot;, conc_units, &quot;)&quot;)
  AUC_units          = paste0(&quot;h.&quot;, conc_units)
  concnorm_label     = paste0(&quot;Normalized Concentration (&quot;, conc_units, &quot;)/&quot;, dose_units)
  pd_binary_label    = &quot;Response&quot;
  pd_response_label  = &quot;Responder Rate (%)&quot;</code></pre>
<!--START_EXPLANATION-->
<p>Binary data is data that can take on one of two values. This often happens when there is a characteristic/event/response, etc. of interest that subjects either have/achieve or they don’t. Binary response data can also come out of dichotomizing continuous data. For example in the psoriasis indication the binary response variable PASI90 (yes/no) is defined as subjects achieving a PASI score of at least 90.</p>
<p>There are two broad categories of PK/PD exploratory plots covered on this page</p>
<ol style="list-style-type: decimal">
<li><em>Exposure and Response vs Time</em>, stratified by dose. You may also have heard these referred to as longitudinal (meaning over time).</li>
<li><em>Response vs Exposure</em> at a particular time. For binomial response vs exposure plots, fitting a logistic regression is often helpful, as you will see below.</li>
</ol>
<p>These plots are displayed below. <!--END_EXPLANATION--></p>
</div>
<div id="provide-an-overview-of-the-data" class="section level2">
<h2>Provide an overview of the data</h2>
<!--START_EXPLANATION-->
<p>We start with <em>Expsoure and Response vs Time</em>, or longitduinal plots</p>
<p>Summarize data with Mean +/- 95% confidence intervals for the percent responders over time. Confidence intervals should be claculated with <code>binom::binom.exact()</code>. You should either color or facet by dose group.<br />
<!--END_EXPLANATION--> ### PK and PD marker over time, colored by Dose, mean +/- 95% CI by nominal time <!--START_EXPLANATION--> Questions to ask:</p>
<ul>
<li>How quickly does effect occur?<br />
</li>
<li>Do the PK and PD profiles have the same time scale, or does the PD seem delayed?<br />
</li>
<li>Is there clear separation between the profiles for different doses?</li>
<li>Does the effect appear to increase (decrease) with increasing dose?</li>
<li>Do you detect a saturation of the effect?</li>
</ul>
<!--END_EXPLANATION-->
<pre class="r"><code>#PK data
  gg &lt;- ggplot(data = pk_data, aes(x = NOMTIME, y = LIDV, color = TRTACT_high2low))
  gg &lt;- gg + xgx_stat_ci()
  gg &lt;- gg + xgx_scale_y_log10() 
  gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                    units_plot    = time_units_plot)
  gg &lt;- gg + labs(y=conc_label,color = trtact_label)
  gg &lt;- gg + xgx_annotate_status(status)
  gg &lt;- gg + xgx_annotate_filenames(dirs)
  #if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
  #xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
  print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-3-1.png" width="960" /></p>
<pre class="r"><code>#PD data
  gg &lt;- ggplot(data = pd_data, aes(x = NOMTIME, y = LIDV, color = TRTACT_high2low))
  gg &lt;- gg + xgx_stat_ci(distribution = &quot;binomial&quot;)
  gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                    units_plot    = time_units_plot)
  gg &lt;- gg + scale_y_continuous(labels=scales::percent)
  gg &lt;- gg + labs(y = pd_response_label, color = trtact_label)  
  gg &lt;- gg + xgx_annotate_status(status)
  gg &lt;- gg + xgx_annotate_filenames(dirs)
  #if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
  #xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
  print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-3-2.png" width="960" /></p>
<div id="pk-and-pd-marker-over-time-faceted-by-dose-mean---95-ci-by-nominal-time" class="section level3">
<h3>PK and PD marker over time, faceted by Dose, mean +/- 95% CI by nominal time</h3>
<!--START_EXPLANATION-->
<p>If coloring by dose makes a messy plot, you can try faceting by dose instead. Here we show the same data, but faceted by dose. <!--END_EXPLANATION--></p>
<pre class="r"><code>#PK data
  gg &lt;- ggplot(data = pk_data, aes(x = NOMTIME, y = LIDV))
  gg &lt;- gg + xgx_stat_ci()
  gg &lt;- gg + xgx_scale_y_log10() 
  gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                    units_plot    = time_units_plot)
  gg &lt;- gg + labs(y=conc_label,color = trtact_label)
  gg &lt;- gg + facet_grid(~TRTACT_low2high)
  gg &lt;- gg + xgx_annotate_status(status)
  gg &lt;- gg + xgx_annotate_filenames(dirs)
  #if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
  #xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
  print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<pre class="r"><code>#PD data
  gg &lt;- ggplot(data = pd_data, aes(x = NOMTIME, y = LIDV))
  gg &lt;- gg + xgx_stat_ci(distribution = &quot;binomial&quot;)
  gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                    units_plot    = time_units_plot)
  gg &lt;- gg + scale_y_continuous(labels=scales::percent)
  gg &lt;- gg + labs(y = pd_response_label, color = trtact_label)  
  gg &lt;- gg + facet_grid(~TRTACT_low2high)
  gg &lt;- gg + xgx_annotate_status(status)
  gg &lt;- gg + xgx_annotate_filenames(dirs)
  #if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
  #xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
  print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-4-2.png" width="960" /></p>
</div>
<div id="pk-over-time-dots-colored-by-response-type" class="section level3">
<h3>PK over time, dots colored by response type</h3>
<!--START_EXPLANATION-->
<p>Another longitudinal plot that can be useful for binary data is plotting the PK over time for all individuals, and coloring by response type. This plot is often used for adverse events plotting. For studies with few PK observations, a PK model may be needed in order to produce concentrations at each time point where response is measured. <!--END_EXPLANATION--></p>
<pre class="r"><code>gg &lt;- ggplot(data = pkpd_data_wide, aes(x = NOMTIME, y = CONC))
gg &lt;- gg + geom_boxplot(aes(group = factor(NOMTIME)), width = 0.5*24)
gg &lt;- gg + geom_jitter(aes( color = factor(BINARY_LEVELS), alpha = factor(BINARY_LEVELS)), width = 0.1*24, height = 0) 
gg &lt;- gg + scale_color_manual(values = c(&quot;black&quot;,&quot;blue&quot;)) + scale_alpha_manual(values = c(0.2,1))
gg &lt;- gg + labs(y = conc_label, color = &quot;Response&quot;, alpha = &quot;Response&quot;)
gg &lt;- gg + xgx_scale_y_log10()
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                    units_plot    = time_units_plot)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
</div>
</div>
<div id="explore-variability" class="section level2">
<h2>Explore Variability</h2>
<div id="pk-and-pd-marker-over-time-colored-by-dose-dots-lines-grouped-by-individuals" class="section level3">
<h3>PK and PD marker over time, colored by Dose, dots &amp; lines grouped by individuals</h3>
<!--START_EXPLANATION-->
<p>Use spaghetti plots to visualize the extent of variability between individuals. The wider the spread of the profiles, the higher the between subject variability. Distinguish different doses by color, or separate into different panels.</p>
<p>When plotting individual binomial data, it is often helpful to stagger the dots and use transparency, so that it is easier to detect individual dots. <!--END_EXPLANATION--></p>
<pre class="r"><code>gg &lt;- ggplot(data = pk_data, aes(x = TIME, y = LIDV)) 
gg &lt;- gg + geom_line(aes(group = ID, color = factor(TRTACT_high2low)), size = 1, alpha = 0.5) 
gg &lt;- gg + geom_point(data = pk_data %&gt;% filter(CENS==0), aes(color = TRTACT_high2low), size = 2, alpha = 0.5)
gg &lt;- gg + geom_point(data = pk_data %&gt;% filter(CENS==1), color=&quot;red&quot;,  shape=8, size = 2, alpha = 0.5)
gg &lt;- gg + xgx_scale_y_log10()
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg &lt;- gg + labs(y = conc_label, color = trtact_label)
gg &lt;- gg + xgx_annotate_status(status) 
gg &lt;- gg + xgx_annotate_filenames(dirs)
#if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
#xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<pre class="r"><code>gg &lt;- ggplot(data = pd_data, aes(x = TIME, y = LIDV_jitter)) 
gg &lt;- gg + geom_line(aes(group = ID, color = factor(TRTACT_high2low)), size = 1, alpha = 0.5) 
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg &lt;- gg + scale_y_continuous(labels=scales::percent)
gg &lt;- gg + labs(y = conc_label, color = pd_response_label)
gg &lt;- gg + xgx_annotate_status(status) 
gg &lt;- gg + xgx_annotate_filenames(dirs)
#if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
#xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-6-2.png" width="960" /></p>
</div>
<div id="pk-and-pd-marker-over-time-faceted-by-dose-dots-lines-grouped-by-individuals" class="section level3">
<h3>PK and PD marker over time, faceted by Dose, dots &amp; lines grouped by individuals</h3>
<pre class="r"><code>gg &lt;- ggplot(data = pk_data, aes(x = TIME, y = LIDV)) 
gg &lt;- gg + geom_line(aes(group = ID), size = 1, alpha = 0.2)  
gg &lt;- gg + geom_point(aes(color = factor(CENS), shape = factor(CENS), alpha = 0.3), size = 2, alpha = 0.2)
gg &lt;- gg + scale_shape_manual(values=c(1,8))
gg &lt;- gg + scale_color_manual(values=c(&quot;grey50&quot;,&quot;red&quot;))
gg &lt;- gg + xgx_scale_y_log10()
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg &lt;- gg + labs(y = conc_label, shape = &quot;BLQ&quot;, color = &quot;BLQ&quot;)
gg &lt;- gg + facet_grid(.~TRTACT_low2high)
gg &lt;- gg + xgx_annotate_status(status)
gg &lt;- gg + xgx_annotate_filenames(dirs)
#if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
#xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-7-1.png" width="960" /></p>
<pre class="r"><code>gg &lt;- ggplot(data = pd_data, aes(x = TIME, y = LIDV_jitter)) 
gg &lt;- gg + geom_line(aes(group = ID), alpha = 0.2)  
gg &lt;- gg + geom_point(size = 2, alpha = 0.2)
gg &lt;- gg + xgx_scale_x_time_units(units_dataset = time_units_dataset, 
                                  units_plot    = time_units_plot)
gg &lt;- gg + labs(y = pd_binary_label, shape = &quot;BLQ&quot;, color = &quot;BLQ&quot;)
gg &lt;- gg + facet_grid(.~TRTACT_low2high)
gg &lt;- gg + xgx_annotate_status(status)
gg &lt;- gg + xgx_annotate_filenames(dirs)
#if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
#xgx_save(width,height,dirs,&quot;filename_main&quot;,status)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-7-2.png" width="960" /></p>
</div>
</div>
<div id="explore-exposure-response-relationship" class="section level2">
<h2>Explore Exposure-Response Relationship</h2>
<pre class="r"><code>gg &lt;- ggplot(data = pkpd_data_wide, aes(y = CONC, x = PD))
gg &lt;- gg + geom_boxplot(aes(group = PD), width = 0.5, outlier.shape=NA) 
gg &lt;- gg + geom_jitter(data = pkpd_data_wide %&gt;% filter(CENS == 0, PROFDAY == 5), 
                       aes(color = TRTACT_high2low), shape=19,  width = 0.1, height = 0.0, alpha = 0.5)
gg &lt;- gg + geom_jitter(data = pkpd_data_wide %&gt;% filter(CENS == 1, PROFDAY == 5),
                       color = &quot;red&quot;, shape=8,  width = 0.1, height = 0.0, alpha = 0.5)
gg &lt;- gg + xgx_scale_y_log10()
gg &lt;- gg + labs(x = pd_binary_label, y = conc_label, color = trtact_label)
gg &lt;- gg + coord_flip() 
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-8-1.png" width="768" /> <!--START_EXPLANATION--> Plot response against exposure. Include a logistic regression for binary data to help determine the shape of the exposure-respone relationship. Summary information such as mean and 95% confidence intervals by quartiles of exposure can also be plotted. The exposure metric that you use in these plots could be either raw concentrations, or NCA or model-derived exposure metrics (e.g. Cmin, Cmax, AUC), and may depend on the level of data that you have available. <!--END_EXPLANATION--></p>
<pre class="r"><code>pkpd_data_wide_plot = pkpd_data_wide %&gt;%
  mutate(PROFDAY_STR = paste(&quot;Day&quot;,PROFDAY)) %&gt;%
  filter(PROFDAY %in% c(1,3,5)) %&gt;%
  mutate(CONC_QUART = cut(CONC, quantile(CONC, na.rm=TRUE), na.rm=TRUE, include.lowest = TRUE)) %&gt;%
  group_by(CONC_QUART) %&gt;%
  mutate(CONC_MIDPOINT = median(CONC))

gg &lt;- ggplot(data = pkpd_data_wide_plot, aes(x = CONC, y = PD))
gg &lt;- gg + geom_jitter(aes(color = TRTACT_high2low), width = 0, height = 0.05, alpha = 0.5) 
gg &lt;- gg + geom_smooth(method = &quot;glm&quot;, method.args = list(family=binomial(link = logit)), color = &quot;black&quot;)
gg &lt;- gg + xgx_stat_ci(aes(x = CONC_MIDPOINT, y = PD), distribution = &quot;binomial&quot;, geom = &quot;errorbar&quot;, size = 0.5)
gg &lt;- gg + xgx_stat_ci(aes(x = CONC_MIDPOINT, y = PD), distribution = &quot;binomial&quot;, geom = &quot;point&quot;, shape = 0, size = 4)
gg &lt;- gg + scale_y_continuous(labels=scales::percent)
gg &lt;- gg + labs(x = conc_label, y = pd_response_label, color = trtact_label)
gg &lt;- gg + xgx_scale_x_log10()
gg &lt;- gg + facet_grid(~PROFDAY_STR)
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-9-1.png" width="960" /> <!--START_EXPLANATION--> Plotting AUC vs response instead of concentration vs response may make more sense in some situations. For example, when there is a large delay between PK and PD it would be diffcult to relate the time-varying concentration with the response. If rich sampling is only done at a particular point in the study, e.g. at steady state, then the AUC calculated on the rich profile could be used as the exposure variable for a number of PD visits. If PK samples are scarce, average Cmin could also be used as the exposure metric. <!--END_EXPLANATION--></p>
<pre class="r"><code>NCA_plot = NCA %&gt;%
  group_by(PARAM) %&gt;%
  mutate(VALUE_QUART = cut(VALUE, quantile(VALUE, na.rm=TRUE), na.rm=TRUE, include.lowest = TRUE)) %&gt;%
  group_by(PARAM, VALUE_QUART) %&gt;%
  mutate(VALUE_MIDPOINT = median(VALUE))

gg &lt;- ggplot(NCA_plot, aes(x = VALUE, y = PD))
gg &lt;- gg + geom_jitter(aes( color = TRTACT_high2low), width = 0, height = 0.05, alpha = 0.5) 
gg &lt;- gg + geom_smooth(method = &quot;glm&quot;, method.args = list(family=binomial(link = logit)), color = &quot;black&quot;)
gg &lt;- gg + xgx_stat_ci(mapping = aes(x = VALUE_MIDPOINT, y = PD), 
                       conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;point&quot;), shape = 0, size = 4)
gg &lt;- gg + xgx_stat_ci(mapping = aes(x = VALUE_MIDPOINT, y = PD), 
                       conf_level = 0.95, distribution = &quot;binomial&quot;, geom = c(&quot;errorbar&quot;), size = 0.5)
gg &lt;- gg + facet_wrap(~DAY_label + PARAM, scales = &quot;free_x&quot;)
gg &lt;- gg + labs(color = trtact_label, x = &quot;NCA parameter&quot;, y = pd_response_label)
gg &lt;- gg + xgx_scale_x_log10()
gg &lt;- gg + scale_y_continuous(breaks=c(0,.5,1), labels = scales::percent) 
print(gg)</code></pre>
<p><img src="Multiple_Ascending_Dose_PKPD_binary_files/figure-html/unnamed-chunk-10-1.png" width="768" /></p>
<div id="explore-covariate-effects-on-exposure-response-relationship" class="section level3">
<h3>Explore covariate effects on Exposure-Response Relationship</h3>
<!--START_EXPLANATION-->
<p>Stratify exposure-response plots by covariates of interest to explore whether any key covariates impact response independent of exposure. For examples of plots and code startifying by covariate, see <a href="Multiple_Ascending_Dose_PKPD_continuous.html#explore_covariate_effects_on_exposure-response_relationship">Continuous PKPD Covariate Section</a> <!--END_EXPLANATION--> ## R Session Info</p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Red Hat Enterprise Linux
## 
## Matrix products: default
## BLAS/LAPACK: /CHBS/apps/EB/software/imkl/2019.1.144-gompi-2019a/compilers_and_libraries_2019.1.144/linux/mkl/lib/intel64_lin/libmkl_gf_lp64.so
## 
## Random number generation:
##  RNG:     Mersenne-Twister 
##  Normal:  Inversion 
##  Sample:  Rounding 
##  
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] survminer_0.4.9 ggpubr_0.4.0    survival_3.2-11 knitr_1.33      broom_0.7.9     caTools_1.18.2  DT_0.18        
##  [8] forcats_0.5.1   stringr_1.4.0   purrr_0.3.4     readr_2.0.1     tibble_3.1.3    tidyverse_1.3.1 zoo_1.8-9      
## [15] xgxr_1.1.1      gridExtra_2.3   tidyr_1.1.3     dplyr_1.0.7     ggplot2_3.3.5  
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_2.0-2    ggsignif_0.6.2      rio_0.5.27          ellipsis_0.3.2      class_7.3-19       
##   [6] rsconnect_0.8.24    htmlTable_2.2.1     markdown_1.1        base64enc_0.1-3     fs_1.5.0           
##  [11] gld_2.6.2           rstudioapi_0.13     proxy_0.4-26        farver_2.1.0        Deriv_4.1.3        
##  [16] fansi_0.5.0         mvtnorm_1.1-2       lubridate_1.7.10    xml2_1.3.2          codetools_0.2-18   
##  [21] splines_4.1.0       rootSolve_1.8.2.2   Formula_1.2-4       jsonlite_1.7.2      km.ci_0.5-2        
##  [26] binom_1.1-1         cluster_2.1.2       dbplyr_2.1.1        png_0.1-7           compiler_4.1.0     
##  [31] httr_1.4.2          backports_1.2.1     assertthat_0.2.1    Matrix_1.3-3        cli_3.0.1          
##  [36] prettyunits_1.1.1   htmltools_0.5.1.1   tools_4.1.0         gtable_0.3.0        glue_1.4.2         
##  [41] lmom_2.8            Rcpp_1.0.7          carData_3.0-4       cellranger_1.1.0    jquerylib_0.1.4    
##  [46] vctrs_0.3.8         nlme_3.1-152        crosstalk_1.1.1     xfun_0.25           openxlsx_4.2.4     
##  [51] rvest_1.0.1         lifecycle_1.0.0     rstatix_0.7.0       MASS_7.3-54         scales_1.1.1       
##  [56] hms_1.1.0           expm_0.999-6        RColorBrewer_1.1-2  curl_4.3.2          yaml_2.2.1         
##  [61] Exact_2.1           KMsurv_0.1-5        pander_0.6.4        sass_0.4.0          rpart_4.1-15       
##  [66] reshape_0.8.8       latticeExtra_0.6-29 stringi_1.7.3       highr_0.9           e1071_1.7-8        
##  [71] checkmate_2.0.0     zip_2.2.0           boot_1.3-28         rlang_0.4.11        pkgconfig_2.0.3    
##  [76] bitops_1.0-7        evaluate_0.14       lattice_0.20-44     htmlwidgets_1.5.3   labeling_0.4.2     
##  [81] tidyselect_1.1.1    GGally_2.1.2        plyr_1.8.6          magrittr_2.0.1      R6_2.5.1           
##  [86] DescTools_0.99.42   generics_0.1.0      Hmisc_4.5-0         DBI_1.1.1           pillar_1.6.2       
##  [91] haven_2.4.3         foreign_0.8-81      withr_2.4.2         mgcv_1.8-35         abind_1.4-5        
##  [96] RCurl_1.98-1.4      nnet_7.3-16         car_3.0-11          modelr_0.1.8        crayon_1.4.1       
## [101] survMisc_0.5.5      utf8_1.2.2          tzdb_0.1.2          rmarkdown_2.11      jpeg_0.1-9         
## [106] progress_1.2.2      grid_4.1.0          readxl_1.3.1        minpack.lm_1.2-1    data.table_1.14.0  
## [111] reprex_2.0.1        digest_0.6.27       xtable_1.8-4        munsell_0.5.0       bslib_0.2.5.1</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
